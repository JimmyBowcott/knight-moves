(()=>{"use strict";const e=document.querySelector(".board"),t={start:null,target:null,draggedPiece:null,lastSquare:null,pieces:[],createBoard(){for(let t=0;t<8;t++)for(let a=0;a<8;a++){const r=document.createElement("div");r.classList.add("square",(t+a)%2==0?"light":"dark"),r.dataset.row=t,r.dataset.col=a,e.appendChild(r)}t.lastSquare=t.getRandomSquare()},createPiece(e){const a=document.createElement("img");return a.id=e,a.src="../media/"+e+".png",a.alt=e,a.draggable=!1,a.classList.add("piece"),a.addEventListener("mousedown",t.startDrag),a.addEventListener("dragstart",(e=>e.preventDefault())),t.pieces.push(a),a},getRandomSquare(){const e=document.querySelectorAll(".square");let t=Math.floor(Math.random()*e.length);for(;1===e[t].children.length;)t=Math.floor(Math.random()*e.length);return e[t]},initializePieces(){t.createPiece("pawn"),t.createPiece("knight"),t.pieces.forEach((e=>{const a=t.getRandomSquare();a.appendChild(e),t.updatePosition(e.id,a)}))},startDrag(e){t.draggedPiece=e.target,t.draggedPiece.style.transition="none",document.addEventListener("mousemove",t.dragPiece),document.addEventListener("mouseup",t.dropPiece),document.addEventListener("mouseleave",t.cancelDrag)},dragPiece(e){if(!t.draggedPiece)return;t.draggedPiece.style.transform=`translate(${e.pageX-t.draggedPiece.x-25}px,${e.pageY-t.draggedPiece.y-80}px)`;const a=t.getTargetSquare(e);a&&(a.classList.contains("light")?(t.lastSquare.classList.remove("lightdrag"),t.lastSquare.classList.remove("darkdrag"),a.classList.add("lightdrag"),t.lastSquare=a):a.classList.contains("dark")&&(t.lastSquare.classList.remove("lightdrag"),t.lastSquare.classList.remove("darkdrag"),a.classList.add("darkdrag"),t.lastSquare=a))},async dropPiece(e){if(!t.draggedPiece)return;document.removeEventListener("mousemove",t.dragPiece),document.removeEventListener("mouseup",t.dropPiece),document.removeEventListener("mouseleave",t.cancelDrag);const a=t.getTargetSquare(e),r=document.querySelector(".board");a&&r.contains(a)&&1!==a.children.length?(a&&(a.appendChild(t.draggedPiece),t.draggedPiece.style.transform=`translate(${e.pageX-t.draggedPiece.x-25}px,${e.pageY-t.draggedPiece.y-40}px)`,t.draggedPiece.style.transform="translate(0,-40px)",t.updatePosition(t.draggedPiece.id,a),await t.delay(100),t.draggedPiece.style.transition="transform 0.35s ease-in-out"),t.draggedPiece=null,t.lastSquare.classList.remove("lightdrag"),t.lastSquare.classList.remove("darkdrag")):t.cancelDrag()},cancelDrag(){t.draggedPiece&&(t.draggedPiece.style.transform="translate(0,-40px)",t.draggedPiece.style.transition="transform 0.35s ease-in-out",t.draggedPiece=null,document.removeEventListener("mousemove",t.dragPiece),document.removeEventListener("mouseup",t.dropPiece),document.removeEventListener("mouseleave",t.cancelDrag),t.lastSquare.classList.remove("lightdrag"),t.lastSquare.classList.remove("darkdrag"))},getTargetSquare(e){t.draggedPiece.style.display="none";let a=document.elementFromPoint(e.clientX,e.clientY);if(a)return a=a.closest(".square"),t.draggedPiece.style.display="",a;t.draggedPiece.style.display=""},updatePosition(e,a){"knight"===e?t.start=[parseInt(a.dataset.row),parseInt(a.dataset.col)]:t.target=[parseInt(a.dataset.row),parseInt(a.dataset.col)]},delay:e=>new Promise((t=>setTimeout(t,e))),async moveKnight(e){t.disableClicking();const a=document.getElementById("knight");let r=[0,-40];for(let s=1;s<e.length;s++){const d=t.getOffset(e[s-1],e[s]);r[0]+=d[0],a.style.transform=`translate(${r[0]}px, ${r[1]}px)`,await t.delay(350),r[1]+=d[1],a.style.transform=`translate(${r[0]}px, ${r[1]}px)`,await t.delay(250),s===e.length-1&&t.hidePiece("pawn"),await t.delay(250)}await t.delay(2e3),t.resetPiece("knight"),t.resetPiece("pawn"),await t.delay(1e3),t.enableClicking()},hidePiece(e){(e=document.getElementById(e)).classList.add("taken")},disableClicking(){document.getElementById("start").classList.add("disabled"),document.querySelector(".board").classList.add("disabled")},enableClicking(){document.getElementById("start").classList.remove("disabled"),document.querySelector(".board").classList.remove("disabled")},resetPiece(e){(e=document.getElementById(e)).classList.remove("taken"),e.style.transform="translate(0px, -40px)"},getOffset:(e,t)=>[75*(t[1]-e[1]),60*(t[0]-e[0])]},a=[[1,2],[2,1],[2,-1],[1,-2],[-1,-2],[-2,-1],[-2,1],[-1,2]];class r{constructor(e,t=!1){this.position=e,this.path=this.pass(t)}pass(e){return e||[this.position]}getMoves(){let e=[];for(let t of a){let a=[this.position[0]+t[0],this.position[1]+t[1]];a[0]>=0&&a[0]<=7&&a[1]>=0&&a[1]<=7&&e.push(a)}return e}}t.createBoard(),t.initializePieces(),document.getElementById("start").addEventListener("click",(()=>{const e=function(e,t){for(var a=[new r(e)],s=a.shift();s.position[0]!==t[0]||s.position[1]!==t[1];){let e=s.getMoves();for(var d=0;d<e.length;d++)a.push(new r(e[d],s.path.concat([e[d]])));s=a.shift()}return s.path}(t.start,t.target);t.moveKnight(e)}))})();